# AntV X6 可视化编辑器 - 项目文档

## 项目概述

这是一个基于 AntV X6 图编辑引擎构建的可视化编辑器，用于创建和管理包含输入、环境、空间和输出节点的流程图。项目采用 Vue.js 框架开发，提供了完整的图形编辑、属性配置和场景管理功能。

## 功能特性

### 1. 核心功能

- **节点管理**：
  - 支持四种节点类型：输入、环境、空间和输出
  - 拖拽创建节点
  - 双击节点编辑属性
  - 右键菜单删除节点
  - 节点自动编号

- **连线功能**：
  - 节点间拖拽连线
  - 连线验证（防止无效连接）
  - 连线样式自定义
  - 右键删除连线

- **编辑操作**：
  - 撤销/重做功能（Ctrl+Z/Ctrl+R）
  - 节点移动和调整大小
  - 属性面板实时编辑
  - 节点分组和嵌套

### 2. 组件说明

- **组件面板**：
  - 分类显示可用组件
  - 拖拽组件到画布
  - 组件双击快速创建

- **画布区域**：
  - 无限画布
  - 网格背景
  - 鼠标滚轮缩放
  - 平移功能
  - 小地图导航

- **属性面板**：
  - 场景编辑和组件编辑双标签页
  - 动态表单根据节点类型变化
  - 属性实时保存

### 3. 高级功能

- **历史记录**：
  - 支持最多100步操作记录
  - 可视化操作历史

- **节点交互**：
  - 悬停效果
  - 点击选中
  - 双击编辑

- **数据持久化**：
  - 场景保存
  - 节点数据保存
  - 导出JSON格式

## 项目结构

```
src/home/
├── HomeMain.vue            # 主界面布局
├── modules/
│   ├── CanvasArea.vue       # 画布区域组件
│   ├── ComponentPanel.vue   # 组件面板
│   ├── ConnectionManager.js # 连线管理
│   ├── DragManager.js       # 拖拽管理
│   ├── GraphManager.js      # 图形管理核心
│   ├── HoverManager.js      # 悬停效果管理
│   ├── NodeEditor.js        # 节点编辑器配置
│   └── PropertyPanel.vue    # 属性面板
```

## 技术栈

- **核心框架**：Vue.js 2.x
- **图形引擎**：AntV X6
- **UI组件**：原生HTML/CSS
- **构建工具**：Vue CLI

## 安装与运行

### 开发环境

1. 安装依赖：
```bash
npm install
```

2. 启动开发服务器：
```bash
npm run serve
```

3. 访问应用：
```
http://localhost:8080
```

### 生产构建

```bash
npm run build
```

## 使用指南

### 基本操作

1. **添加节点**：
   - 从左侧组件面板拖拽到画布
   - 或双击组件快速添加

2. **连接节点**：
   - 从一个节点的连接桩拖拽到另一个节点的连接桩

3. **编辑节点**：
   - 点击节点选中
   - 在右侧属性面板编辑
   - 或双击节点打开详细编辑

4. **删除元素**：
   - 右键点击节点/连线
   - 选择删除确认

### 快捷键

- `Ctrl+Z`：撤销
- `Ctrl+R`：重做
- 鼠标滚轮：缩放画布
- 鼠标右键拖拽：平移画布

## 配置选项

可在`GraphManager.js`中修改以下配置：

- 节点样式（颜色、大小）
- 连线样式
- 历史记录步数
- 网格样式
- 小地图设置

## 数据格式

### 场景保存格式示例

```json
{
  "scene": {
    "name": "场景名称",
    "description": "场景描述"
  },
  "nodes": [
    {
      "id": "node1",
      "label": "输入 #1",
      "category": "输入",
      "data": {
        "formData": {
          "description": "输入描述"
        }
      },
      "position": {
        "x": 100,
        "y": 100
      }
    }
  ],
  "edges": [
    {
      "source": "node1",
      "target": "node2"
    }
  ]
}
```

## 开发扩展

### 添加新节点类型

1. 在`HomeMain.vue`的`componentCategories`中添加新分类
2. 在`NodeEditor.js`中添加对应的表单配置
3. 在`GraphManager.js`的`colorMap`中添加样式配置

### 自定义连线规则

修改`ConnectionManager.js`中的`validateConnection`方法实现自定义验证逻辑。

## 常见问题

### 节点重叠

系统会自动检测并避免节点重叠，如果仍需调整：
1. 手动拖动节点
2. 使用"美化图形"功能自动排列

### 连线失败

检查：
1. 节点是否有正确的连接桩
2. 连线是否符合验证规则
3. 是否启用了连线功能

## 许可证

MIT License